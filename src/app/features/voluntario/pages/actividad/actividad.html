<div class="max-w-5xl mx-auto pb-10">

    <!-- Volver -->
    <a routerLink="/voluntario/historial"
        class="inline-flex items-center gap-2 text-gray-500 hover:text-gray-900 mb-4 transition-colors">
        <i class="fa-solid fa-arrow-left"></i> Volver al historial
    </a>

    <!-- Loading -->
    @if (cargando()) {
    <div class="flex items-center justify-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
    }

    @if (!cargando() && actividad(); as act) {
    <!-- Header con imagen de fondo -->
    <div class="relative h-64 md:h-80 rounded-3xl overflow-hidden shadow-md mb-8 bg-gradient-to-r"
        [ngClass]="!act.imagen ? 'from-blue-600 to-indigo-700' : 'bg-gray-900'">

        @if (act.imagen) {
        <img [src]="'http://localhost:8000/uploads/actividades/' + act.imagen"
            class="absolute inset-0 w-full h-full object-cover opacity-70" alt="Portada actividad">
        }

        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent"></div>

        <div class="absolute bottom-0 left-0 p-8 w-full z-10">
            @if (act.tipos && act.tipos.length > 0) {
            <span
                class="inline-block px-3 py-1 bg-white/20 backdrop-blur-sm text-white text-xs font-bold rounded-full mb-3">
                {{ act.tipos[0] }}
            </span>
            }
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">{{ act.titulo }}</h1>

            <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-bold"
                [ngClass]="getEstadoClass(act.estado_solicitud)">
                <i class="fa-solid" [ngClass]="{
            'fa-check-circle': act.estado_solicitud === 'Aceptada',
            'fa-clock': act.estado_solicitud === 'Pendiente',
            'fa-times-circle': act.estado_solicitud === 'Rechazada',
            'fa-flag-checkered': act.estado_solicitud === 'Finalizada',
            'fa-ban': act.estado_solicitud === 'Cancelada'
          }"></i>
                {{ act.estado_solicitud }}
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Columna principal -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Descripción -->
            <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-lg font-bold text-gray-900 mb-3">Sobre la actividad</h2>
                <p class="text-gray-600 leading-relaxed">
                    {{ act.descripcion || 'Sin descripción disponible.' }}
                </p>
            </section>

            <!-- ODS -->
            @if (act.ods && act.ods.length > 0) {
            <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-lg font-bold text-gray-900 mb-4">Objetivos de Desarrollo Sostenible</h2>
                <div class="flex flex-wrap gap-3">
                    @for (ods of act.ods; track ods.id) {
                    <div class="bg-emerald-100 text-emerald-800 px-4 py-2 rounded-xl flex items-center gap-2">
                        <span class="text-lg font-bold">{{ ods.id }}</span>
                        <span class="text-sm font-medium">{{ ods.nombre }}</span>
                    </div>
                    }
                </div>
            </section>
            }
        </div>

        <!-- Sidebar con información y acciones -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-4">

                <!-- Organización -->
                <div class="flex items-center gap-3 mb-6 pb-6 border-b border-gray-100">
                    <div
                        class="w-12 h-12 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center font-bold text-xl">
                        {{ act.organizacion.charAt(0) }}
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 uppercase font-bold">Organiza</p>
                        <p class="font-bold text-gray-900">{{ act.organizacion }}</p>
                    </div>
                </div>

                <!-- Detalles -->
                <div class="space-y-4 mb-8">
                    <div class="flex items-start gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0">
                            <i class="fa-regular fa-calendar"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900">{{ formatearFecha(act.fecha_inicio) }}</p>
                            <p class="text-xs text-gray-500">Fecha de la actividad</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center flex-shrink-0">
                            <i class="fa-regular fa-clock"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900">{{ act.duracion_horas }} horas</p>
                            <p class="text-xs text-gray-500">Duración estimada</p>
                        </div>
                    </div>

                    @if (act.ubicacion) {
                    <div class="flex items-start gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center flex-shrink-0">
                            <i class="fa-solid fa-location-dot"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900">{{ act.ubicacion }}</p>
                            <p class="text-xs text-gray-500">Ubicación</p>
                        </div>
                    </div>
                    }
                </div>

                <!-- Acciones según estado (Originales, sin mi modal) -->
                <div class="space-y-3">

                    @if (act.estado_solicitud === 'Pendiente') {
                    <div
                        class="bg-orange-50 text-orange-700 p-3 rounded-xl text-sm font-medium text-center border border-orange-100">
                        <i class="fa-solid fa-clock mr-2"></i> Tu inscripción está pendiente de aprobación
                    </div>
                    <button (click)="desapuntarse()" [disabled]="procesando()"
                        class="w-full py-3 bg-white text-red-500 border-2 border-red-100 font-bold rounded-xl hover:bg-red-50 transition-colors disabled:opacity-50">
                        @if (procesando()) {
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> Procesando...
                        } @else {
                        <i class="fa-solid fa-xmark mr-2"></i> Cancelar inscripción
                        }
                    </button>
                    }

                    @else if (act.estado_solicitud === 'Aceptada') {
                    <div
                        class="bg-green-50 text-green-700 p-3 rounded-xl text-sm font-medium text-center border border-green-100">
                        <i class="fa-solid fa-check-circle mr-2"></i> ¡Tu inscripción ha sido aceptada!
                    </div>
                    <button (click)="desapuntarse()" [disabled]="procesando()"
                        class="w-full py-3 bg-white text-red-500 border-2 border-red-100 font-bold rounded-xl hover:bg-red-50 transition-colors disabled:opacity-50">
                        @if (procesando()) {
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> Procesando...
                        } @else {
                        <i class="fa-solid fa-xmark mr-2"></i> Desapuntarse
                        }
                    </button>
                    }

                    @else if (act.estado_solicitud === 'Finalizada') {
                    <div class="bg-gray-100 text-gray-600 p-3 rounded-xl text-sm font-medium text-center">
                        <i class="fa-solid fa-flag-checkered mr-2"></i> Actividad finalizada
                    </div>
                    }

                    @else if (act.estado_solicitud === 'Rechazada') {
                    <div
                        class="bg-red-50 text-red-600 p-3 rounded-xl text-sm font-medium text-center border border-red-100">
                        <i class="fa-solid fa-times-circle mr-2"></i> Tu inscripción fue rechazada
                    </div>
                    }

                    @else if (act.estado_solicitud === 'Cancelada') {
                    <div class="bg-gray-100 text-gray-600 p-3 rounded-xl text-sm font-medium text-center">
                        <i class="fa-solid fa-ban mr-2"></i> Actividad cancelada
                    </div>
                    }

                    @else {
                    <button (click)="inscribirse()" [disabled]="procesando()"
                        class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-md hover:bg-blue-700 transition-all disabled:opacity-50">
                        @if (procesando()) {
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> Procesando...
                        } @else {
                        <i class="fa-solid fa-hand-holding-heart mr-2"></i> Inscribirse
                        }
                    </button>
                    }
                </div>
            </div>
        </div>

    </div>
    }

    @if (!cargando() && !actividad()) {
    <div class="bg-white rounded-2xl p-12 text-center shadow-sm border border-gray-100">
        <div class="w-20 h-20 rounded-full bg-gray-100 mx-auto flex items-center justify-center mb-4">
            <i class="fa-solid fa-question text-3xl text-gray-400"></i>
        </div>
        <h2 class="text-xl font-bold text-gray-700">Actividad no encontrada</h2>
        <p class="text-gray-500 mt-2">La actividad que buscas no existe o no tienes acceso.</p>
        <a routerLink="/voluntario/actividades"
            class="inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
            Ver actividades disponibles
        </a>
    </div>
    }
</div>

<!-- Modal de confirmación -->
<app-confirm-modal
    [isOpen]="confirmModalVisible()"
    [title]="confirmModalTitle()"
    [message]="confirmModalMessage()"
    [confirmText]="confirmModalButtonText()"
    (confirm)="onConfirmModalConfirm()"
    (cancel)="onConfirmModalCancel()">
</app-confirm-modal>

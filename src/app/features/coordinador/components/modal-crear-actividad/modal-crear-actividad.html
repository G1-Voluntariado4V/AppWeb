<div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto">

  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]">

    <!-- Header -->
    <div class="px-8 py-5 border-b border-gray-100 flex justify-between items-center bg-white shrink-0">
      <h2 class="text-2xl font-bold text-gray-900">Nueva Actividad</h2>
      <button (click)="cerrar()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>

    <!-- Content -->
    <div class="p-8 bg-gray-50/50 overflow-y-auto custom-scrollbar">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Columna Izquierda -->
        <div class="lg:col-span-2 space-y-6">

          <!-- Título -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">Título *</label>
            <input type="text" [(ngModel)]="titulo"
              class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 focus:bg-white outline-none transition-all placeholder-gray-400"
              placeholder="Ej: Recogida de Alimentos">
          </div>

          <!-- Descripción -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">Descripción</label>
            <textarea [(ngModel)]="descripcion" rows="4"
              class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 focus:bg-white outline-none transition-all placeholder-gray-400 resize-none"
              placeholder="Describe los detalles de la actividad..."></textarea>
          </div>

          <!-- Ubicación -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ubicación</label>
            <input type="text" [(ngModel)]="ubicacion"
              class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 focus:bg-white outline-none transition-all placeholder-gray-400"
              placeholder="Ej: Centro Cívico de Pamplona">
          </div>

          <!-- ODS -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-4">
              Selecciona los ODS
              <span class="text-xs font-normal text-gray-400">({{ odsList().length }} disponibles)</span>
            </label>

            @if (odsList().length === 0) {
            <p class="text-gray-400 text-sm">Cargando ODS...</p>
            } @else {
            <div class="flex flex-wrap gap-3">
              @for (ods of odsList(); track ods.id) {
              <div (click)="toggleOds(ods.id)"
                class="cursor-pointer w-24 h-24 rounded-2xl flex flex-col items-start justify-between p-3 text-white transition-transform hover:scale-105 relative overflow-hidden shadow-md"
                [class]="getOdsStyle(ods.id).color" [class.ring-4]="odsSeleccionados().includes(ods.id)"
                [class.ring-blue-400]="odsSeleccionados().includes(ods.id)"
                [class.opacity-60]="odsSeleccionados().length > 0 && !odsSeleccionados().includes(ods.id)">
                <span class="text-xl font-black opacity-80">{{ ods.id }}</span>
                <div>
                  <i [class]="getOdsStyle(ods.id).icon + ' text-lg mb-1 block'"></i>
                  <span class="text-[8px] font-bold uppercase leading-tight block truncate w-full">{{ ods.nombre
                    }}</span>
                </div>
              </div>
              }
            </div>
            }
          </div>

          <!-- Imagen -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-4">Imagen de Portada</label>

            <input type="file" #fileInput (change)="onFileSelected($event)" class="hidden" accept="image/*">

            <div (click)="fileInput.click()"
              class="border-2 border-dashed border-gray-300 rounded-2xl h-32 flex flex-col items-center justify-center text-gray-400 hover:bg-blue-50 hover:border-blue-400 transition-all cursor-pointer group">

              @if (imagenNombre()) {
              <i class="fa-solid fa-check-circle text-3xl mb-2 text-green-500"></i>
              <span class="text-sm font-bold text-gray-800">{{ imagenNombre() }}</span>
              <span class="text-xs text-blue-500 mt-1">Clic para cambiar</span>
              } @else {
              <i class="fa-regular fa-image text-3xl mb-2 group-hover:text-blue-500 transition-colors"></i>
              <span class="text-sm font-medium group-hover:text-blue-600 transition-colors">Subir imagen</span>
              }
            </div>
          </div>

        </div>

        <!-- Columna Derecha -->
        <div class="space-y-6">

          <!-- Organización -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">Organización *</label>
            <select [(ngModel)]="organizacionId"
              class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 outline-none">
              <option [value]="null" disabled>Selecciona una organización</option>
              @for (org of organizaciones(); track org.id) {
              <option [value]="org.id">{{ org.nombre }}</option>
              }
            </select>
          </div>

          <!-- Tipos de Voluntariado -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-4">Tipos de Voluntariado</label>
            <div class="space-y-3">
              @if (tiposList().length === 0) {
              <p class="text-gray-400 text-sm">Cargando tipos...</p>
              } @else {
              @for (tipo of tiposList(); track tipo.id) {
              <label
                class="flex items-center gap-3 p-3 border rounded-xl cursor-pointer transition-all hover:bg-gray-50"
                [class.border-blue-500]="tiposSeleccionados().includes(tipo.id)"
                [class.bg-blue-50]="tiposSeleccionados().includes(tipo.id)">
                <input type="checkbox" [checked]="tiposSeleccionados().includes(tipo.id)" (change)="toggleTipo(tipo.id)"
                  class="text-blue-600 focus:ring-blue-500 rounded">
                <span class="text-sm font-medium text-gray-700">{{ tipo.nombreTipo }}</span>
              </label>
              }
              }
            </div>
          </div>

          <!-- Fecha -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">Fecha de Inicio *</label>
            <input type="date" [(ngModel)]="fecha"
              class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 outline-none cursor-pointer">
          </div>

          <!-- Duración y Cupo -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
              <label class="block text-sm font-bold text-gray-700 mb-2">Duración (h)</label>
              <input type="number" [(ngModel)]="duracionHoras" min="1" max="24"
                class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 outline-none">
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
              <label class="block text-sm font-bold text-gray-700 mb-2">Cupo máx.</label>
              <input type="number" [(ngModel)]="cupoMaximo" min="1" max="100"
                class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:border-blue-500 outline-none">
            </div>
          </div>

        </div>

      </div>
    </div>

    <!-- Footer -->
    <div class="px-8 py-5 bg-white border-t border-gray-100 flex justify-end gap-3 shrink-0">
      <button (click)="cerrar()"
        class="px-6 py-2.5 rounded-xl text-sm font-bold text-gray-500 hover:bg-gray-100 transition-colors">
        Cancelar
      </button>
      <button (click)="guardar()"
        class="px-8 py-2.5 rounded-xl text-sm font-bold text-white bg-[#2563eb] hover:bg-blue-700 shadow-md transition-all transform hover:-translate-y-0.5">
        Crear Actividad
      </button>
    </div>

  </div>
</div>